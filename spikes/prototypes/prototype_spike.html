<html>

<head>
	<script type="text/javascript" src="jquery-1.6.1.js"></script>
</head>
<body>
	<script type="text/javascript">

function log(message) {
	var output = $(".output");
	var li = $("<li></li>");
	li.text(message);
	output.append(li);
}

$(document).ready(function() {
	log("start");

	(function() {
		log();
		log("Prototype basics:");

		var a = {
			foo: function() { log("a.foo"); }
		};

		var b = function() { log("b (function)") };
		b.bar = function() { log("b.bar"); };
		b.toString = function() { return "b.toString"; };

		var c = function() { log("c (function)") };
		c.prototype.baz = function() { log("c.prototype.baz"); };

		a.foo();
		b1 = new b();
		b.bar();
		c1 = new c();
		log("c1 instanceof c: " + (c1 instanceof c));
		log("c1 instanceof b: " + (c1 instanceof b));
		c.prototype = b;
		c2 = new c();
		c1.baz();
		log("c1.__proto__: " + c1.__proto__);
		c2.bar();
		log("c2.__proto__: " + c2.__proto__);

		log("c1 instanceof c: " + (c1 instanceof c));
		log("c1 instanceof b: " + (c1 instanceof b));
		log("c2 instanceof c: " + (c2 instanceof c));
		log("c2 instanceof b: " + (c2 instanceof b));
	})();

	(function() {
		log();
		log("Object chaining using 'new' keyword:");

		function chainFrom(object) {
			var f = function() {};
			f.prototype = object;
			return new f();
		}

		var a = {
			name: "a",
			foo: function() { log(this.name + ".foo"); }
		};
		a.foo();

		var b = chainFrom(a);
		b.name = "b";
		b.bar = function() { log("b.bar"); };
		b.foo();
		b.bar();
	})();

	(function() {
		log();
		log("Object chaining using Object.create():");

		var a = {
			foo: function() { log("chained foo"); }
		};
		var b = Object.create(a);
		b.foo();
	})();

	(function() {
		log();
		log("Object chaining as a method:");

		var root = {
			chain: function() {
				return Object.create(this)
			}
		};

		var a = root.chain();
		a.foo = function() { log("chained foo"); };

		var b = a.chain();
		b.foo();
	})();

	(function() {
		log();
		log("Object chaining with constructors and parent calls:");

		var root = {
			chain: function(init) {
				var chained = Object.create(this);
				chained.parent = this;
				chained.init = init;
				chained.init();
				return chained;
			},
			init: function() {},
			chainedFrom: function(potentialParent) {
				var test = this;
				while(test) {
					if (test === potentialParent) return true;
					test = test.parent;
				}
				return false;
			}
		};

		log("A:");
		var a = root.chain(function() { log("a.init"); });
		a.name = "a";
		a.foo = function() { log("a.foo"); };
		a.printThis = function() { log("'this' is " + this.name) };
		a.foo();
		a.printThis();

		log("B:");
		var b = a.chain(function() { log("b.init"); });
		b.name = "b";
		b.bar = function() { log("b.bar"); };
		b.foo();
		b.bar();
		b.printThis();

		log("C:");
		var c = b.chain(function() { log("c.init"); this.parent.init(); });
		c.name = "c";
		c.bar = function() { log("c.bar"); this.parent.bar(); };
		c.foo();
		c.bar();
		c.printThis();

		log("Chained from:");
		log("c chained from {}? " + c.chainedFrom({}));
		log("c chained from c? " + c.chainedFrom(c));
		log("c chained from b? " + c.chainedFrom(b));
		log("c chained from a? " + c.chainedFrom(a));
		log("b chained from c? " + b.chainedFrom(c));
		log("b chained from b? " + b.chainedFrom(b));
		log("b chained from a? " + b.chainedFrom(a));
		log("a chained from c? " + a.chainedFrom(c));
		log("a chained from b? " + a.chainedFrom(b));
		log("a chained from a? " + a.chainedFrom(a));
	})();

	(function() {
		log();
		log("Real world scenario:");

		var Root = {
			init: function() {},
			chain: function(init) {
				var chained = Object.create(this);
				chained.parent = this;
				chained._recursiveThis = chained;
				chained.init = init;
				chained.init();
				return chained;
			},
			create: function() {
				var outerArgs = arguments;
				return this.chain(function() {
					this._callParent("init", outerArgs);
				});
			},
			callParent: function(methodName) {
				this._callParent(methodName, Array.prototype.slice.call(arguments, 1));
			},
			_callParent: function(methodName, args) {
				var oldThis = this._recursiveThis;
				this._recursiveThis = oldThis.parent;
				this._recursiveThis[methodName].apply(this, args);
				this._recursiveThis = oldThis;
			},
		};

		var Person = Root.chain(function(name) {
			this.name = name;
		});
		Person.greet = function() {
			log("Hello, my name is " + this.name);
		};
		Person.setName = function(name) {
			log(this.name + " changing name to " + name);
			this.name = name;
		};
		var RudePerson = Person.chain(function(name) {
			this.callParent("init", name);
		});
		RudePerson.greet = function() {
			log("'Bugger off,' says " + this.name);
		}

//		var joe = Person.chain(function() { this.callParent("init", "Joe") });
		var joe = Person.create("Joe");
		var bob = RudePerson.chain(function() {
			this.callParent("init", "Bob");
			log("instantiated bob");
		});

		joe.greet();
		bob.greet();
		bob.setName("Jill");
		joe.greet();
		bob.greet();
	})();

	(function() {
		log();
		log("Classic but memory-intensive approach that supports 'new' keyword and private vars:");

		var Person = function(name) {
			this.greet = function() {
				log("Hello, my name is " + name);
			}
			this.setName = function(newName) {
				log(name + " changing name to " + newName);
				name = newName;
			}
		};
		var RudePerson = function(name) {
			Person.call(this, name);
			this.greet = function() {
				log("'Bugger off,' says " + name);
			}
		}

		var joe = new Person("Joe");
		var bob = new RudePerson("Bob");
		joe.greet();
		bob.greet();
		bob.setName("Jill");
		joe.greet();
		bob.greet();
	})();

	(function() {
		log();
		log("Classic prototype-based approach that supports 'new' keyword but not private vars:");

		var Person = function(name) {
			this._name = name;
		};
		Person.prototype.greet = function() {
			log("Hello, my name is " + this._name);
		};
		Person.prototype.setName = function(newName) {
			log(this._name + " changing name to " + newName);
			this._name = newName;
		};

		var RudePerson = function(name) {
			Person.call(this, name);
		};
		RudePerson.prototype = new Person();
		RudePerson.prototype.greet = function() {
			log("'Bugger off,' says " + this._name);
		};

		var joe = new Person("Joe");
		var bob = new RudePerson("Bob");
		joe.greet();
		bob.greet();
		bob.setName("Jill");
		joe.greet();
		bob.greet();
	})();

	log();
	log("end");
});




	</script>

	<p>Output here:</p>
	<ol class="output">

	</ol>
</body>
</html>